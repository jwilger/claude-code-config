# Claude Code Configuration

**Universal development practices + language-specific implementations for Claude Code**

## Overview

This flake provides strongly opinionated Claude Code configuration that adapts to different programming languages while maintaining universal principles like type-driven development, quality enforcement, and TDD discipline.

## Key Features

- **Universal Principles**: Type safety, never bypass linters, TDD discipline, functional core/imperative shell
- **Language-Specific Implementation**: Each language implements these principles using appropriate tools and syntax
- **Project Customization**: Use `CLAUDE.local.md` to add project-specific architecture and domain details  
- **Update-Safe**: Base configuration managed in Nix store, local customizations preserved
- **Include System**: Seamless merging of base configuration with project-specific content

## Usage with Nix

### Add to Existing Project

In your project's `flake.nix`:

```nix
{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";
    claude-config.url = "github:jwilger/claude-code-config";
  };

  outputs = { self, nixpkgs, claude-config }:
    let
      system = "x86_64-linux";
      pkgs = nixpkgs.legacyPackages.${system};
    in {
      devShells.default = pkgs.mkShell {
        # Your existing development tools
        buildInputs = with pkgs; [ rustc cargo clippy rustfmt ];
        
        # Add Claude Code configuration that regenerates on each shell entry
        shellHook = claude-config.lib.${system}.addClaudeCode "rust" ''
          echo "ðŸ¦€ Rust project ready!"
          # Your existing setup commands
        '';
      };
    };
}
```

### Quick Setup Shells

For immediate use, try the pre-configured development shells:

```bash
# Rust project
nix develop github:jwilger/claude-code-config#rust

# TypeScript project  
nix develop github:jwilger/claude-code-config#typescript
```

### Updating Configuration

To get the latest Claude Code templates and practices:

```bash
# In your project directory
nix flake update claude-config
nix develop  # Regenerates CLAUDE.md and .claude/ with latest version
```

## What Gets Created

### Generated Files (Do Not Edit)

```
CLAUDE.md               # Generated configuration (universal + language-specific)
.claude/
â”œâ”€â”€ settings.json       # MCP server configuration  
â”œâ”€â”€ agents/            # SPARC workflow agents (8 specialized agents)
â”œâ”€â”€ commands/          # Custom slash commands (/sparc, etc.)
â””â”€â”€ hooks/            # Git quality enforcement hooks
```

### Customization Files (You Edit)

```
CLAUDE.local.md         # Project-specific architecture, domain types, etc.
```

## How It Works

1. **Base Configuration**: Universal development principles + language-specific implementations stored in Nix derivation
2. **Template Generation**: `CLAUDE.md` generated by merging base template with language-specific content blocks
3. **Local Customization**: `CLAUDE.local.md` content inserted at include marker `<!-- CLAUDE.local.md -->`
4. **Update Safety**: `nix flake update` brings latest practices while preserving your local customizations

## Language Support

Each language provides specific implementations of universal principles:

- **Rust**: `cargo`, `clippy`, `nextest`, `nutype` for type safety, `proptest` for property testing
- **TypeScript**: `npm`, `eslint`, `typescript`, branded types, Jest/Vitest testing

More languages coming soon!

## Usage Without Nix

If you're not using Nix, you can still benefit from this configuration system by manually copying and adapting the templates:

### Step 1: Copy Base Templates

```bash
# Clone the repository
git clone https://github.com/jwilger/claude-code-config.git
cd claude-code-config

# Copy the SPARC workflow files to your project
cp -r templates/claude-templates/.claude/ /path/to/your/project/
```

### Step 2: Generate Language-Specific CLAUDE.md

Choose your language and manually apply the template substitutions:

**For Rust projects:**
1. Copy `templates/CLAUDE.md.template` to your project as `CLAUDE.md`
2. Replace template variables with Rust-specific values:
   - `{{testRunner}}` â†’ `cargo nextest run`
   - `{{lintCommand}}` â†’ `cargo clippy`
   - `{{languageName}}` â†’ `Rust`
   - etc.
3. Replace content blocks like `{{languageTypeSystemContent}}` with Rust-specific content from the examples

**For other languages:**
- Use the same approach but substitute appropriate tools and practices for your language
- TypeScript: `npm test`, `eslint`, `typescript`, etc.
- Python: `pytest`, `mypy`, `ruff`, etc.
- Go: `go test`, `golangci-lint`, etc.

### Step 3: Add Project-Specific Content

Create `CLAUDE.local.md` with your project's:
- Architecture overview
- Domain types and core components  
- Code structure and key modules
- Testing patterns and architectural decisions

See `examples/CLAUDE.local.md.caxton-example` for reference.

### Step 4: Manual Updates

To get updates:
1. Check this repository for changes to templates
2. Manually merge relevant updates into your `CLAUDE.md`
3. Your `CLAUDE.local.md` stays unchanged

### Why Use Nix Instead?

The Nix approach provides:
- **Automatic Updates**: `nix flake update` pulls latest best practices
- **Zero Maintenance**: No manual template merging
- **Language Consistency**: Guaranteed correct substitutions for each language
- **Include System**: Seamless merging of base + local content

But the manual approach works perfectly if you prefer to manage the configuration yourself!

## SPARC Workflow Integration

This configuration provides a complete SPARC (Story, Planning, Architecture, Research, Code) workflow:

### Specialized Agents
- **researcher**: Gathers authoritative information and creates research briefs
- **planner**: Creates TDD implementation plans with type-driven architecture  
- **red-implementer**: Writes failing tests that capture behavioral intent
- **green-implementer**: Implements minimal code to make tests pass
- **refactor-implementer**: Improves code structure while preserving behavior
- **type-architect**: Designs domain types that make illegal states unrepresentable
- **expert**: Reviews code for correctness, performance, and best practices
- **pr-manager**: Handles GitHub PR operations and workflow coordination

### Commands & Workflow
- **`/sparc`**: Full story workflow with GitHub PR integration
- **Memory Storage**: Every agent stores knowledge for systematic improvement
- **Quality Enforcement**: Git hooks prevent bypassing linters and quality checks
- **PR Integration**: Automated draft PR creation with comprehensive descriptions

## Universal Development Principles

This configuration enforces consistent practices across all languages:

### Type-Driven Development
- **Illegal states are unrepresentable**: Use domain types over primitives
- **Smart constructors**: Validation at construction time
- **Explicit error types**: No silent failures or unhandled exceptions

### Quality Enforcement  
- **Never bypass linters**: No inline suppressions without team approval
- **Pre-commit hooks**: Mandatory quality gates that cannot be bypassed
- **Treat warnings as errors**: Zero tolerance for code quality violations

### Testing Discipline
- **TDD (Red â†’ Green â†’ Refactor)**: Strict adherence to Kent Beck's approach
- **Property-based testing**: Verify invariants and edge cases
- **Functional Core/Imperative Shell**: Pure logic separated from I/O

### Development Workflow
- **SPARC coordination**: Structured story development with memory storage
- **GitHub integration**: Professional PR workflows with proper attribution
- **Branch protection**: Automated safeguards against committing to main during stories

## Requirements

- **For Nix users**: Nix with flakes enabled
- **For all users**: Git, GitHub CLI (for PR management)
- **MCP servers**: Node.js and Python3 (for enhanced Claude Code integration)

## Examples

### Adding to Existing Rust Project

```nix
shellHook = claude-config.lib.${system}.addClaudeCode "rust" ''
  # Your existing setup
  echo "ðŸ¦€ Rust project ready!"
  just --list
'';
```

### Project Customization Example

In `CLAUDE.local.md`:
```markdown
## Architecture Overview

This is an e-commerce platform built with a CRUD architecture...

## Key Domain Types

- **User Management**: `UserId`, `UserEmail`, `UserRole`
- **Product Catalog**: `ProductId`, `SKU`, `Price`, `Inventory`  
- **Order Processing**: `OrderId`, `OrderStatus`, `PaymentInfo`
```

This approach maintains strong development discipline while adapting to your specific project needs.